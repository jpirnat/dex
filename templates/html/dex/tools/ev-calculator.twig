{% extends "html/base.twig" %}

{% block body %}
{% verbatim %}
<div id="app" v-cloak>
	<dex-breadcrumbs :breadcrumbs="breadcrumbs"></dex-breadcrumbs>

	<div class="version-group-control" v-if="versionGroups.length">
		<ul>
			<li v-for="vg in versionGroups">
				<a :href="evCalculatorUrl(vg)"
					:class="{
						'current': vg.identifier === versionGroup.identifier
					}"
				>{{ vg.name }}</a>
			</li>
		</ul>
	</div>

	<div v-if="!loaded" class="dex-loader-container">
		<div class="dex-loader"></div>
	</div>

	<template v-if="loaded">
		<h1 class="dex-page__title">EV Calculator</h1>

		<div class="dex-section__description">
			Have a trained Pokémon you don't know the EV spread for?
			Use this calculator to reverse engineer its EVs.
		</div>

		<div class="dex-section__description">
			You don't need to fill in every stat if you don't need to know every stat.
		</div>

		<div class="ev-calculator__container">
			<div class="ev-calculator__column ev-calculator__column--gap">
				<div>
					<label>
						<span>Pokémon:</span>
						<input type="text" v-model.trim="pokemonName" list="pokemon-names"
							@input="onChangePokemonName"
						>
						<datalist id="pokemon-names">
							<option v-for="p in pokemons" :key="p.identifier" :value="p.name"></option>
						</datalist>
					</label>
					<div v-if="selectedPokemon !== null">Selected Pokémon: {{ selectedPokemon.name }}</div>
				</div>

				<label>
					<span class="ev-calculator__label">Level:</span>
					<input type="number" class="ev-calculator__input--level"
						v-model.number="level"
						min="1" max="100" step="1"
					>
				</label>

				<div>
					<label>
						<span class="ev-calculator__label">Nature:</span>
						<input type="text" v-model.trim="natureName" list="nature-names"
							@input="onChangeNatureName"
						>
						<datalist id="nature-names">
							<option v-for="n in natures" :key="n.identifier" :value="n.expandedName"></option>
						</datalist>
					</label>
					<div v-if="selectedNature !== null">Selected Nature: {{ selectedNature.expandedName }}</div>
				</div>
			</div>
			<div class="ev-calculator__column">
				<div class="ev-calculator__column-title">IVs:</div>
				<label v-for="s in stats" :key="s.identifier"
					:class="{
						'ev-calculator__stat-block': true,
						['dex-table__stat--' + s.identifier]: true,
					}"
				>
					<span class="ev-calculator__label">{{ s.name }}:</span>
					<input type="number" class="ev-calculator__input--iv"
						v-model.number="ivs[s.identifier]"
						min="0" max="31" step="1"
					>
				</label>
			</div>
			<div class="ev-calculator__column">
				<div class="ev-calculator__column-title">Stats:</div>
				<label v-for="s in stats" :key="s.identifier"
					:class="{
						'ev-calculator__stat-block': true,
						['dex-table__stat--' + s.identifier]: true,
					}"
				>
					<span class="ev-calculator__label">{{ s.name }}:</span>
					<input type="number" class="ev-calculator__input--final"
						v-model.number="finalStats[s.identifier]"
						min="1" max="714" step="1"
					>
				</label>
			</div>
			<div class="ev-calculator__column">
				<button :disabled="disableCalculate" @click="calculate">Calculate</button>
			</div>
			<div class="ev-calculator__column">
				<div class="ev-calculator__column-title">EVs:</div>
				<label v-for="s in stats" :key="s.identifier"
					:class="{
						'ev-calculator__stat-block': true,
						['dex-table__stat--' + s.identifier]: true,
					}"
				>
					<span class="ev-calculator__label">{{ s.name }}:</span>
					<input type="text" class="ev-calculator__input--ev"
						v-model="evs[s.identifier]"
					>
				</label>
			</div>
		</div>
	</template>
</div>
{% endverbatim %}

<style>
.ev-calculator__container {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 20px;
}

.ev-calculator__column {
	display: flex;
	flex-direction: column;
}
.ev-calculator__column--gap {
	gap: 20px;
}

.ev-calculator__column-title {
	text-align: center;
	font-weight: bold;
}

.ev-calculator__stat-block {
	padding: 5px;
}

.ev-calculator__label {
	display: inline-block;
	min-width: 70px;
}
.ev-calculator__input--level,
.ev-calculator__input--final {
	width: 60px;
}
.ev-calculator__input--iv {
	width: 50px;
}
.ev-calculator__input--ev {
	width: 120px;
}
</style>
{% endblock %}

{% block scripts %}
	<script src="https://cdn.jsdelivr.net/npm/vue@2.7"></script>
	<script src="/js/dex-breadcrumbs.js"></script>

	<script src="/js/dex/tools/ev-calculator.js"></script>
{% endblock %}
