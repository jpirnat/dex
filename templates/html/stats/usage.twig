{% extends "html/base.twig" %}

{% block styles %}
	<link href="/css/vtooltip.css" rel="stylesheet">
	<link href="/css/dex-pagination.css" rel="stylesheet">
{% endblock %}

{% block body %}
{% verbatim %}
<div id="app" v-cloak>
	<div v-if="!loaded">
		Loading...
	</div>
	<div v-else>
		<dex-breadcrumbs :breadcrumbs="breadcrumbs"></dex-breadcrumbs>

		<div class="month-control">
			<a v-if="prevMonth" class="button prev" :href="`/stats/${prevMonth.month}/${format.identifier}/${rating}`">
				&#9668; {{ prevMonth.text }}
			</a>

			<div class="space"></div>

			<a v-if="nextMonth" class="button next" :href="`/stats/${nextMonth.month}/${format.identifier}/${rating}`">
				{{ nextMonth.text }} &#9658;
			</a>
		</div>

		<div class="rating-control">
			<ul>
				<li v-for="r in ratings">
					<a :href="`/stats/${thisMonth.month}/${format.identifier}/${r}`"
						:class="{
							'current': r === rating
						}"
					>{{ r }}</a>
				</li>
			</ul>
		</div>

		<div class="buttons-control">
			<a v-if="showLeadsLink" class="button"
				:href="`/stats/${thisMonth.month}/${format.identifier}/${rating}/leads`"
			>
				Leads
			</a>

			<div class="space"></div>

			<div v-if="showSaveAsDefaultFormat" class="button" @click="saveAsDefaultFormat">
				Save as my default format
			</div>
		</div>

		<dex-pagination
			v-model="currentPage"
			:number-of-items="filteredPokemons.length"
			:items-per-page="itemsPerPage"
		></dex-pagination>

		<div class="stats-usage__filter">
			<label>
				Search by Pokémon name: <input type="search" v-model="filterName">
			</label>
		</div>

		<table class="pokemon-usage">
			<thead>
				<tr>
					<th class="dex-table__header--sortable" @click="sortBy('rank', 'asc')"
						:class="{
							'dex-table__header--sorted-asc': sortColumn === 'rank' && sortDirection === 'asc',
							'dex-table__header--sorted-desc': sortColumn === 'rank' && sortDirection === 'desc',
						}"
					>Rank</th>
					<th></th>
					<th class="pokemon-name dex-table__header--sortable" @click="sortBy('name', 'asc')"
						:class="{
							'dex-table__header--sorted-asc': sortColumn === 'name' && sortDirection === 'asc',
							'dex-table__header--sorted-desc': sortColumn === 'name' && sortDirection === 'desc',
						}"
					>Pokémon</th>
					<th class="dex-table__header--sortable" @click="sortBy('usagePercent', 'desc')"
						:class="{
							'dex-table__header--sorted-asc': sortColumn === 'usagePercent' && sortDirection === 'asc',
							'dex-table__header--sorted-desc': sortColumn === 'usagePercent' && sortDirection === 'desc',
						}"
					>Usage&nbsp;%</th>
					<th class="dex-table__header--sortable" @click="sortBy('usageChange', 'desc')"
						:class="{
							'dex-table__header--sorted-asc': sortColumn === 'usageChange' && sortDirection === 'asc',
							'dex-table__header--sorted-desc': sortColumn === 'usageChange' && sortDirection === 'desc',
						}"
					>Usage&nbsp;Δ</th>
					<th class="dex-table__header--sortable" @click="sortBy('raw', 'desc')"
						:class="{
							'dex-table__header--sorted-asc': sortColumn === 'raw' && sortDirection === 'asc',
							'dex-table__header--sorted-desc': sortColumn === 'raw' && sortDirection === 'desc',
						}"
					>Raw</th>
					<th class="dex-table__header--sortable" @click="sortBy('rawPercent', 'desc')"
						:class="{
							'dex-table__header--sorted-asc': sortColumn === 'rawPercent' && sortDirection === 'asc',
							'dex-table__header--sorted-desc': sortColumn === 'rawPercent' && sortDirection === 'desc',
						}"
					>Raw&nbsp;%</th>
					<th class="dex-table__header--sortable" @click="sortBy('real', 'desc')"
						:class="{
							'dex-table__header--sorted-asc': sortColumn === 'real' && sortDirection === 'asc',
							'dex-table__header--sorted-desc': sortColumn === 'real' && sortDirection === 'desc',
						}"
					>Real</th>
					<th class="dex-table__header--sortable" @click="sortBy('realPercent', 'desc')"
						:class="{
							'dex-table__header--sorted-asc': sortColumn === 'realPercent' && sortDirection === 'asc',
							'dex-table__header--sorted-desc': sortColumn === 'realPercent' && sortDirection === 'desc',
						}"
					>Real&nbsp;%</th>
				</tr>
			</thead>
			<tbody>
				<tr v-for="pokemon in paginatedPokemons" :key="pokemon.identifier">
					<td class="dex-table--number">{{ pokemon.rank }}</td>
					<td class="dex-table__pokemon-icon">
						<img :src="`/images/pokemon/icons/${pokemon.icon}`">
					</td>
					<td>
						<a v-if="showMovesetLink(pokemon)"
							:href="`/stats/${thisMonth.month}/${format.identifier}/${rating}/pokemon/${pokemon.identifier}`"
						>{{ pokemon.name }}</a>
						<template v-else>{{ pokemon.name }}</template>
					</td>
					<td class="dex-table--number">{{ pokemon.usagePercentText }}</td>
					<td	class="dex-table--number"
						:class="{
							'dex-table--percent-plus': pokemon.usageChange > 0,
							'dex-table--percent-minus': pokemon.usageChange < 0,
						}"
					>
						<a class="trend-link"
							:href="`/stats/chart?type=usage&format=${format.identifier}&rating=${rating}&pokemon=${pokemon.identifier}`"
						>{{ pokemon.usageChangeText }}</a>
					</td>
					<td class="dex-table--number">{{ pokemon.rawText }}</td>
					<td class="dex-table--number">{{ pokemon.rawPercentText }}</td>
					<td class="dex-table--number">{{ pokemon.realText }}</td>
					<td class="dex-table--number">{{ pokemon.realPercentText }}</td>
				</tr>
			</tbody>
		</table>

		<dex-pagination
			v-model="currentPage"
			:number-of-items="filteredPokemons.length"
			:items-per-page="itemsPerPage"
		></dex-pagination>
	</div>
</div>
{% endverbatim %}
{% endblock %}

{% block scripts %}
	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
	<script src="/js/dex-breadcrumbs.js"></script>

	<script src="https://unpkg.com/v-tooltip"></script>
	<script src="/js/dex-pagination.js"></script>

	<script src="/js/stats/usage.js"></script>
{% endblock %}
