{% extends "html/base.twig" %}

{% block styles %}
	<link href="/css/vtooltip.css" rel="stylesheet">
	<link href="/css/dex-pagination.css" rel="stylesheet">
{% endblock %}

{% block body %}
{% verbatim %}
<div id="app" v-cloak>
	<dex-breadcrumbs :breadcrumbs="breadcrumbs"></dex-breadcrumbs>

	<div class="month-control">
		<a v-if="prevMonth" class="button prev" :href="`/stats/${prevMonth.month}/${format.identifier}/${rating}/leads`">
			&#9668; {{ prevMonth.text }}
		</a>

		<div class="space"></div>

		<a v-if="nextMonth" class="button next" :href="`/stats/${nextMonth.month}/${format.identifier}/${rating}/leads`">
			{{ nextMonth.text }} &#9658;
		</a>
	</div>

	<div class="rating-control">
		<ul>
			<li v-for="r in ratings">
				<a :href="`/stats/${thisMonth.month}/${format.identifier}/${r}/leads`"
					:class="{
						'current': r === rating
					}"
				>{{ r }}</a>
			</li>
		</ul>
	</div>

	<dex-pagination
		v-model="currentPage"
		:number-of-items="filteredPokemons.length"
		:items-per-page="itemsPerPage"
	></dex-pagination>

	<div class="stats-usage__filter">
		<label>
			Filter by Pokémon name: <input type="search" v-model="filterName">
		</label>
	</div>

	<table class="pokemon-usage">
		<thead>
			<tr>
				<th class="dex-table__header--sortable" @click="sortBy('rank', 'asc')"
					:class="{
						'dex-table__header--sorted-asc': sortColumn === 'rank' && sortDirection === 'asc',
						'dex-table__header--sorted-desc': sortColumn === 'rank' && sortDirection === 'desc',
					}"
				>Rank</th>
				<th></th>
				<th class="pokemon-name dex-table__header--sortable" @click="sortBy('name', 'asc')"
					:class="{
						'dex-table__header--sorted-asc': sortColumn === 'name' && sortDirection === 'asc',
						'dex-table__header--sorted-desc': sortColumn === 'name' && sortDirection === 'desc',
					}"
				>Pokémon</th>
				<th class="dex-table__header--sortable" @click="sortBy('usagePercent', 'desc')"
					:class="{
						'dex-table__header--sorted-asc': sortColumn === 'usagePercent' && sortDirection === 'asc',
						'dex-table__header--sorted-desc': sortColumn === 'usagePercent' && sortDirection === 'desc',
					}"
				>Usage&nbsp;%</th>
				<th class="dex-table__header--sortable" @click="sortBy('usageChange', 'desc')"
					:class="{
						'dex-table__header--sorted-asc': sortColumn === 'usageChange' && sortDirection === 'asc',
						'dex-table__header--sorted-desc': sortColumn === 'usageChange' && sortDirection === 'desc',
					}"
				>Usage&nbsp;Δ</th>
				<th class="dex-table__header--sortable" @click="sortBy('raw', 'desc')"
					:class="{
						'dex-table__header--sorted-asc': sortColumn === 'raw' && sortDirection === 'asc',
						'dex-table__header--sorted-desc': sortColumn === 'raw' && sortDirection === 'desc',
					}"
				>Raw</th>
				<th class="dex-table__header--sortable" @click="sortBy('rawPercent', 'desc')"
					:class="{
						'dex-table__header--sorted-asc': sortColumn === 'rawPercent' && sortDirection === 'asc',
						'dex-table__header--sorted-desc': sortColumn === 'rawPercent' && sortDirection === 'desc',
					}"
				>Raw&nbsp;%</th>
			</tr>
		</thead>
		<tbody>
			<tr v-for="pokemon in paginatedPokemons" :key="pokemon.identifier">
				<td class="dex-table--number">{{ pokemon.rank }}</td>
				<td class="dex-table__pokemon-icon">
					<img :src="`/images/pokemon/icons/${pokemon.icon}`">
				</td>
				<td>
					<a
						:href="`/stats/${thisMonth.month}/${format.identifier}/${rating}/pokemon/${pokemon.identifier}`"
					>{{ pokemon.name }}</a>
				</td>
				<td class="dex-table--number">{{ pokemon.usagePercentText }}</td>
				<td	class="dex-table--number chart-link"
					:class="{
						'dex-table--percent-plus': pokemon.usageChange > 0,
						'dex-table--percent-minus': pokemon.usageChange < 0,
					}"
					@click="addChartLine(pokemon)"
				>
					<div class="chart-link__inner">
						{{ pokemon.usageChangeText }}
						<img class="chart-link__icon" src="/images/porydex/chart-icon.png">
					</div>
				</td>
				<td class="dex-table--number">{{ pokemon.rawText }}</td>
				<td class="dex-table--number">{{ pokemon.rawPercentText }}</td>
			</tr>
			<tr v-if="!loaded">
				<td colspan="7" class="dex-table__loading">Loading...</td>
			</tr>
		</tbody>
	</table>

	<dex-pagination
		v-model="currentPage"
		:number-of-items="filteredPokemons.length"
		:items-per-page="itemsPerPage"
	></dex-pagination>

	<dex-chart-drawer
		:lines="chartLines"
		:ratings="ratings"
	></dex-chart-drawer>
</div>
{% endverbatim %}
{% endblock %}

{% block scripts %}
	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
	<script src="/js/dex-breadcrumbs.js"></script>

	<script src="https://unpkg.com/v-tooltip"></script>
	<script src="/js/dex-pagination.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment-with-locales.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
	<script src="/js/dex-chart-drawer.js"></script>

	<script src="/js/stats/leads.js"></script>
{% endblock %}
